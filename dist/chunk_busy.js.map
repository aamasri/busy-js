{"version":3,"file":"chunk_busy.js","mappings":"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","sources":["webpack://@aamasri/busy/./src/busy.js","webpack://@aamasri/busy/./src/busy.styl"],"sourcesContent":["/**\n * @fileOverview busy animation\n */\n\nconst debug = false;\n\nimport './busy.styl';\n\nlet busyAnimation = false;\nlet modalOverlay = false;\nlet fadeoutAnimationTimer = false;\nlet fadeoutModalTimer = false;\nexport let queue = [];\n\n\n\n// start loading animation\nexport async function start(id, timeout=7, modal=false) {\n    window.clearTimeout(fadeoutAnimationTimer);\n    id = id ? id.replace(/'/g, '') : '';\t// strip any single quotes from id\n    timeout = (typeof timeout === 'number') ? timeout * 1000 : 7000;\n\n    const duplicateItem = queue.findIndex(item => item.id === id);\n    if (duplicateItem > -1) {\n        queue.splice(duplicateItem, 1);\n        if (debug) console.debug(`busy item \"${id}\" already in queue!`);\n    }\n\n    // the queue is the master list controlling the busy animation\n    queue.push({\n        id: id,\n        expiry: Date.now() + timeout,\n        modal: modal\n    });\n\n    _updateBusy();\n    window.setTimeout(() => { stop(id); }, timeout);   // dequeue item after timeout\n}\n\n\n\n\n// stop loading animation\nexport function stop(id) {\n    if (queue.length) {\n        id = id ? id.toString().replace(/'/g, '') : '';\t// strip any single quotes from id\n        let arrayIndex;\n\n        // pop specified busy id off queue\n        if (id) {\n            arrayIndex = queue.findIndex(busyItem => busyItem.id === id);\n            if (arrayIndex > -1) {\n                if (debug) console.debug(`busy item \"${queue[arrayIndex].id}\" stopped!`);\n                queue.splice(arrayIndex, 1);\n            }\n        }\n\n        // remove any expired item from the queue\n        queue.forEach(item => {\n            if (item.expiry <= Date.now()) {\n                arrayIndex = queue.findIndex(busyItem => busyItem.id === item.id);\n                if (arrayIndex > -1) {\n                    if (debug) console.debug(`removing expired busy item \"${queue[arrayIndex].id}\"`);\n                    queue.splice(arrayIndex, 1);\n                }\n            }\n        })\n    }\n\n    _updateBusy();\n}\n\n\n\n\n// clear the busy queue and stop the busy animation\nexport function reset() {\n    queue = [];\n    _updateBusy();\n}\n\n\n\n// debug the busy animation queue\nexport function status() {\n    console.log('busy queue:', queue);\n}\n\n\n\n// monitor the queue and update the busy animation\nfunction _updateBusy() {\n    if (debug) console.debug(`_updateBusy() queue length: ${queue.length}`);\n    if (queue.length === 0) {\n        _fadeOutAnimation();\n        _fadeOutModal();\n    } else {\n        _showAnimation(queue[0].id);\n        if (queue.some(item => item.modal))\n            _showModal()\n        else\n            _fadeOutModal();\n    }\n}\n\n\n\nfunction _showAnimation(id) {\n    window.clearTimeout(fadeoutAnimationTimer);\n\n    // create busy animation elements if it doesn't exist (they can be hidden but never removed)\n    if (!busyAnimation) {\n        // detects whether we're in an iframe - we always want to attach the busy animation to the root document\n        const isInIframe = window.location !== window.parent.location;\n        const body = isInIframe ? parent.document.body : document.body;\n\n        modalOverlay = document.createElement('div');\n        modalOverlay.id = 'animated-loader-modal-overlay';\n        document.body.appendChild(modalOverlay);\n\n        busyAnimation = document.createElement('div');\n        busyAnimation.id = 'animated-loader';\n        busyAnimation.innerHTML = '<div><div><div><div><div><div><div><div><div><div></div></div></div></div></div></div></div></div></div>';\n        body.appendChild(busyAnimation);\n    }\n\n    const topZ = onTopZIndex().toString();\n    busyAnimation.style.zIndex = topZ;\n    modalOverlay.style.zIndex = topZ;\n    busyAnimation.title = id;\n    busyAnimation.style.display = 'block';\n    busyAnimation.style.opacity = '1';\n}\n\nfunction _showModal() {\n    window.clearTimeout(fadeoutModalTimer);\n    modalOverlay.style.display = 'block';\n    modalOverlay.style.opacity = '1';\n}\n\nfunction _fadeOutAnimation() {\n    window.clearTimeout(fadeoutAnimationTimer);\n\n    // fade out\n    busyAnimation.style.opacity = '0';\n\n    // then hide\n    fadeoutAnimationTimer = window.setTimeout(() => {\n        busyAnimation.style.display = 'none';\n    }, 500);   // hide\n}\n\nfunction _fadeOutModal() {\n    window.clearTimeout(fadeoutModalTimer);\n\n    // fadeout\n    modalOverlay.style.opacity = '0';\n\n    // then hide\n    fadeoutModalTimer = window.setTimeout(() => {\n        modalOverlay.style.display = 'none';\n    }, 500);   // hide\n}\n\n\n\n\n/** Get the highest z-index in the document.\n *\n * @returns {number}\n */\nfunction onTopZIndex() {\n    let zTop = 0;\n    const elements = document.getElementsByTagName('*');\n\n    for (let i = 0; i < elements.length; i++) {\n        let zIndex = window.getComputedStyle(elements[i]).getPropertyValue('z-index');\n        zIndex = isNaN(zIndex) ? 0 : parseInt(zIndex);\n        if (zIndex && zIndex > zTop)\n            zTop = zIndex;\n    }\n\n    return zTop;\n}\n\n","// extracted by mini-css-extract-plugin\nexport {};"],"names":["debug","busyAnimation","modalOverlay","fadeoutAnimationTimer","fadeoutModalTimer","queue","start","id","timeout","modal","window","clearTimeout","replace","duplicateItem","findIndex","item","splice","console","push","expiry","Date","now","_updateBusy","setTimeout","stop","length","toString","arrayIndex","busyItem","forEach","reset","status","log","_fadeOutAnimation","_fadeOutModal","_showAnimation","some","_showModal","isInIframe","location","parent","body","document","createElement","appendChild","innerHTML","topZ","onTopZIndex","style","zIndex","title","display","opacity","zTop","elements","getElementsByTagName","i","getComputedStyle","getPropertyValue","isNaN","parseInt"],"sourceRoot":""}